generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id        Int      @id @default(autoincrement())
  name      String
  role      String   @default("TEACHER")
  createdAt DateTime @default(now())

  ownedStandards         Standard[]      @relation("StandardOwner")
  managedIndicators      Indicator[]     @relation("IndicatorManager")
  assignedChecklistItems ChecklistItem[] @relation("ChecklistAssignee")
}

model Standard {
  id         Int    @id @default(autoincrement())
  standardNo Int
  title      String
  ownerId    Int?
  owner      User?  @relation("StandardOwner", fields: [ownerId], references: [id])

  indicators Indicator[]
  createdAt  DateTime    @default(now())

  @@unique([standardNo])
}

model Indicator {
  id         Int    @id @default(autoincrement())
  standardId Int
  code       String
  name       String
  status     String @default("NOT_STARTED")
  progress   Int    @default(0)
  managerId  Int?
  manager    User?  @relation("IndicatorManager", fields: [managerId], references: [id])

  standard  Standard        @relation(fields: [standardId], references: [id])
  checklist ChecklistItem[]
  createdAt DateTime        @default(now())

  @@index([standardId])
  @@index([code])
}

model ChecklistItem {
  id          Int    @id @default(autoincrement())
  indicatorId Int
  text        String
  status      String @default("NOT_STARTED")
  assigneeId  Int?
  assignee    User?  @relation("ChecklistAssignee", fields: [assigneeId], references: [id])

  indicator Indicator      @relation(fields: [indicatorId], references: [id])
  evidence  EvidenceFile[]
  comments  Comment[]
  createdAt DateTime       @default(now())

  @@index([indicatorId])
}

model EvidenceFile {
  id              Int      @id @default(autoincrement())
  checklistItemId Int?
  indicatorId     Int?
  filename        String
  path            String
  driveFileId     String?
  webViewLink     String?
  uploadedBy      String?
  uploadedAt      DateTime @default(now())

  checklistItem ChecklistItem? @relation(fields: [checklistItemId], references: [id])
}

model Comment {
  id              Int      @id @default(autoincrement())
  checklistItemId Int
  authorName      String
  text            String
  createdAt       DateTime @default(now())

  checklistItem ChecklistItem @relation(fields: [checklistItemId], references: [id])
}
